# コスト最適化ガイド

## 現在の構成と月額コスト

### 現在の構成（t3a.medium）
- **EC2 t3a.medium**: 約$16/月（1,920円）
- **EBS 30GB gp3**: 約$2.4/月（288円）
- **Elastic IP**: 約$3.6/月（432円）
- **合計**: 約2,640円/月

### 基本構成（t3a.small）
- **EC2 t3a.small**: 約$8/月（960円）
- **EBS 30GB gp3**: 約$2.4/月（288円）
- **Elastic IP**: 約$3.6/月（432円）
- **合計**: 約1,680円/月 ✅ 予算内

## コスト削減のポイント

### 1. インスタンスタイプの選択

| タイプ | vCPU | メモリ | 月額 | 推奨用途 |
|--------|------|--------|------|----------|
| t3a.small | 2 | 2GB | 960円 | 5人未満、軽量MOD |
| t3a.medium | 2 | 4GB | 1,920円 | 5-10人、中量MOD |
| t3.small | 2 | 2GB | 1,200円 | t3aより安定 |

**推奨**: t3a.small（5人未満なら十分）

### 2. 使用時間の最適化

**自動シャットダウン設定**
- 毎日深夜3時に自動停止
- 月間稼働時間: 約180時間（25%）
- **実質コスト**: 約312円/月

**EventBridge設定例**:
```
スケジュール: cron(0 18 * * ? *)  # JST 3:00 = UTC 18:00
ターゲット: EC2 StopInstances
```

### 3. Elastic IP を使わない

- Elastic IP: 約$3.6/月（432円）
- **代替案**: Discord Botで動的IPを通知（参考記事の方法）
- **節約**: 432円/月

### 4. ストレージの最適化

- **gp3**: $0.08/GB/月（推奨）
- **gp2**: $0.10/GB/月
- 20GB → 30GB: 差額は約48円/月

### 5. Spot Instanceの活用（上級者向け）

- 通常価格の70%オフ
- t3a.small: 約288円/月
- **注意**: 突然停止する可能性あり

## 最終推奨構成

### 構成A: 常時稼働（予算内）
```
- EC2: t3a.small
- EBS: 30GB gp3
- Elastic IP: なし
- 月額: 約1,248円
```

### 構成B: 自動停止（超低コスト）
```
- EC2: t3a.small（月180時間稼働）
- EBS: 30GB gp3
- Elastic IP: なし
- EventBridge: 自動停止
- 月額: 約600円
```

### 構成C: 高性能（予算オーバー）
```
- EC2: t3a.medium
- EBS: 30GB gp3
- 月額: 約2,208円
```

## 実装済みの最適化

現在のTerraform設定:
- ✅ t3a.small（t3.smallより安価）
- ✅ gp3ストレージ（gp2より安価）
- ✅ Elastic IPなし
- ✅ メモリ割り当て最適化（1536MB）

## 追加の節約方法

### 1. Elastic IPを削除（推奨）
- **節約**: 432円/月
- **実装**: Elastic IPを削除し、起動時にDiscord Botで動的IPを通知
- **デメリット**: 起動のたびにIPアドレスが変わる
- **対策**: Discord Botで自動通知すれば問題なし

### 2. t3a.smallにダウングレード
- **節約**: 960円/月
- **実装**: `terraform.tfvars`で`instance_type = "t3a.small"`に変更
- **デメリット**: メモリ2GB（MOD多い場合は動作が重くなる可能性）
- **推奨**: 5人未満、軽量MODなら問題なし

### 3. リザーブドインスタンス（1年契約）
- 約40%オフ
- t3a.medium: 約1,152円/月
- t3a.small: 約576円/月
- **注意**: 1年間の契約が必要

### 4. Savings Plans
- 柔軟性のある割引プラン
- 約30-40%オフ

### 5. バックアップの最適化
- S3 Standard: $0.023/GB/月
- S3 Glacier: $0.004/GB/月（長期保存用）
- 10GBバックアップ: 約28円/月

## モニタリング

### コスト確認方法
```bash
# AWS CLIでコスト確認
aws ce get-cost-and-usage \
  --time-period Start=2026-02-01,End=2026-02-28 \
  --granularity MONTHLY \
  --metrics BlendedCost
```

### AWS Cost Explorer
- AWS Console → Billing → Cost Explorer
- 日次・月次のコスト推移を確認

## まとめ

**現在の設定: 月額2,640円（t3a.medium + Elastic IP）**

### コスト削減オプション（優先順）

#### オプション1: Elastic IP削除（推奨）
- **月額**: 2,208円（-432円）
- **難易度**: 低
- **リスク**: なし（Discord Botで動的IP通知）

#### オプション2: t3a.smallにダウングレード
- **月額**: 1,680円（-960円、Elastic IP込み）
- **月額**: 1,248円（-1,392円、Elastic IPなし）
- **難易度**: 低
- **リスク**: 中（MOD多い場合は動作が重い可能性）

#### オプション3: 自動停止の活用
- **月額**: 約600円（月180時間稼働想定）
- **難易度**: 低（既に実装済み）
- **リスク**: なし

#### オプション4: Reserved Instance（1年契約）
- **月額**: 1,584円（t3a.medium、-1,056円）
- **月額**: 1,008円（t3a.small、-1,632円）
- **難易度**: 低
- **リスク**: なし（1年契約が必要）

### 推奨構成

**予算重視（月額1,248円）**:
- t3a.small
- Elastic IPなし
- 自動停止機能活用

**性能重視（月額2,208円）**:
- t3a.medium（現在の構成）
- Elastic IPなし
- 自動停止機能活用

**バランス型（月額1,680円）**:
- t3a.small
- Elastic IP込み
- 自動停止機能活用
